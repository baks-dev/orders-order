executeFunc((function initBasketService(){if(typeof MCDatepicker==="object"){baksetinitDatapickerOnLoad();return true}return false}));const order_form_button=document.getElementById("order_form_order");order_form_button.addEventListener("click",(function(event){const services=document.querySelectorAll(".services .service-item");let count_invalid=0;for(let index=0;index<services.length;index++){let service_date=document.getElementById("order_form_serv_"+index+"_date");if(service_date.hasAttribute("required")&&service_date.value.length===0){service_date.classList.add("is-invalid")}else{service_date.classList.remove("is-invalid")}if(count_invalid){event.preventDefault();return false}}for(let index=0;index<services.length;index++){let service_period=document.getElementById("order_form_serv_"+index+"_period");if(service_period.hasAttribute("required")&&service_period.value.length===0){service_period.classList.add("is-invalid")}else{service_period.classList.remove("is-invalid")}if(count_invalid){event.preventDefault();return false}}}));const services_checkboxes=document.querySelectorAll(".service_select");services_checkboxes.forEach((function(services_checkbox){services_checkbox.addEventListener("click",(function(){if(this.checked===false){document.getElementById("order_form_service_"+this.dataset.index).classList.add("d-none");document.getElementById("order_form_serv_"+this.dataset.index+"_date").required=false;const service_summary=document.getElementById("service_summary-"+this.dataset.index);if(service_summary){service_summary.remove()}let period_select=document.getElementById("order_form_serv_"+this.dataset.index+"_period");if(period_select!=="undefined"){period_select.selectedIndex=0}document.getElementById("order_form_serv_"+this.dataset.index+"_period").required=false}else{document.getElementById("order_form_service_"+this.dataset.index).classList.remove("d-none");document.getElementById("order_form_serv_"+this.dataset.index+"_date").required=true;document.getElementById("order_form_serv_"+this.dataset.index+"_period").required=true}}))}));function baksetinitDatapickerOnLoad(){const services=document.querySelectorAll(".services .service-item");for(let index=0;index<services.length;index++){const id="order_form_serv_"+index+"_date";const datepicker=MCDatepicker.create({el:"#"+id,minDate:new Date,bodyType:"modal",autoClose:false,closeOndblclick:true,closeOnBlur:false,customOkBTN:"OK",customClearBTN:datapickerLang[$locale].customClearBTN,customCancelBTN:datapickerLang[$locale].customCancelBTN,firstWeekday:datapickerLang[$locale].firstWeekday,dateFormat:"DD.MM.YYYY",customWeekDays:datapickerLang[$locale].customWeekDays,customMonths:datapickerLang[$locale].customMonths});datepicker.onSelect((function(date,formatedDate){const order_form=document.forms.order_form;changeBasketServicePeriod(order_form,index,formatedDate);document.getElementById("order_form_serv_"+index+"_date").classList.remove("is-invalid")}))}}async function changeBasketServicePeriod(form,index=0,formatedDate){const data=new FormData(form);data.delete(form.name+"[_token]");data.delete(form.name+"[order_form_serv_0_period]");await fetch(form.action,{method:form.method,cache:"no-cache",credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest"},redirect:"follow",referrerPolicy:"no-referrer",body:data}).then((response=>{if(response.status!==200){return false}return response.text()})).then((data=>{if(data){const result=parseFormData(data);const period_id="order_form_serv_"+index+"_period";document.getElementById(period_id).replaceWith(result.getElementById(period_id));const services_periods=document.querySelectorAll(".service-period");services_periods.forEach((function(item){item.addEventListener("change",(function(){const selectedOption=item.options[item.selectedIndex];setServiceSummary(formatedDate,selectedOption.text,index);if(item.value){document.getElementById("order_form_serv_"+index+"_period").classList.remove("is-invalid")}}))}))}}))}function setServiceSummary(date,period_value,index){let service_summary=document.getElementById("service_summary-"+index);let service_price=document.getElementById("order_form_serv_"+index+"_money");let service_name=document.getElementById("order_form_serv_"+index+"_name");if(service_summary){service_summary.remove()}if(!service_summary){service_summary=document.createElement("div");service_summary.setAttribute("id","service_summary-"+index);service_summary.classList.add("mb-2")}service_summary.textContent=service_name.value+" (от "+service_price.value+" р)";const total_result_submit=document.querySelector("#selected-services");const service_selected=document.getElementById("order_form_serv_"+index+"_selected");const service_period=document.getElementById("order_form_serv_"+index+"_period");if(service_selected.checked===true&&service_period.value){total_result_submit.after(service_summary)}}function parseFormData(data){const parser=new DOMParser;return parser.parseFromString(data,"text/html")}