executeFunc(function editOrderProductItems(){let productItems=document.querySelectorAll('[data-group="product-items"]');if(typeof productItems==="undefined"||productItems===null){return false}productItems.forEach(initHsH22s6NM);return true});function initHsH22s6NM(item){const changePriceBtn=item.querySelectorAll('[data-action*="price"]');changePriceBtn.forEach(changeOrderProductItemPriceByClick);const changePriceInput=item.querySelectorAll(".item-price");changePriceInput.forEach(changeOrderProductItemPriceByInput);const itemDiscounts=item.querySelectorAll(".item-discount");itemDiscounts.forEach(changeOrderProductItemPriceByDiscount);const deletItems=item.querySelectorAll(".delete-el");deletItems.forEach(deleteOrderProductItem)}function deleteOrderProductItem(btn){btn.addEventListener("click",function(event){const itemForDelete=document.getElementById(this.dataset.id);if(!itemForDelete){return}const totalInput=document.getElementById(btn.dataset.total);let items=itemForDelete.parentNode;let totalMin=totalInput.dataset.min;if(parseInt(items.dataset.itemsCount)<=parseInt(totalMin)){let dangerToast='{ "type":"danger" , '+'"header":"Ошибка при изменении заказа"  , '+`"message" : "Минимальное количество продуктов в заказе - ${totalMin}" }`;createToast(JSON.parse(dangerToast));return}if(itemForDelete){const itemPrice=itemForDelete.querySelector("#"+itemForDelete.id+"_price_price");itemForDelete.remove();let itemsAfterDel=items.querySelectorAll('[data-item="product-item"]');const newCount=itemsAfterDel.length;items.setAttribute("data-items-count",newCount);const productTotal=document.getElementById(itemPrice.dataset.total);productTotal.value=newCount;modifyOrderProductTotal(itemPrice)}})}function changeOrderProductItemPriceByDiscount(input){input.addEventListener("input",function(event){const discount=this.value*-1;let price=document.getElementById(this.dataset.target);let current_price=price.dataset.price;let product_price=parseFloat(current_price);let discount_product_price=product_price-product_price/100*discount;price.value=discount_product_price;modifyOrderProductTotal(price)})}function changeOrderProductItemPriceByInput(input){let timer;input.addEventListener("input",function(event){clearTimeout(timer);timer=setTimeout(()=>{modifyOrderProductTotal(this)},1e3)})}function changeOrderProductItemPriceByClick(btn){btn.addEventListener("click",function(event){let inpt=document.getElementById(this.dataset.id);let inptValue=inpt.value;const action=btn.dataset.action;if(action!=="price-plus"&&action!=="price-minus"){return}let result=parseFloat(inptValue.replace(",","."));if(action==="price-minus"){result=result-(this.dataset.step?this.dataset.step*1:1);if(result<=0){return}}if(action==="price-plus"){result=result+(this.dataset.step?this.dataset.step*1:1)}let price=document.getElementById(this.dataset.id);price.value=result;modifyOrderProductTotal(price)})}function modifyOrderProductTotal(el){let product_summ=document.getElementById("summ_"+el.dataset.total);const items=document.getElementById(el.dataset.item+"-items");let items_summ=null;if(items){items.querySelectorAll(".item-price").forEach(function(el){let result=parseFloat(el.value.replace(",","."));items_summ+=result})}let result_product_sum=new Intl.NumberFormat($locale,{style:"currency",currency:product_summ.dataset.currency,maximumFractionDigits:0}).format(items_summ);product_summ.innerText=result_product_sum;product_summ.setAttribute("data-total",items_summ);let total_sum=null;let product_list=document.getElementById("order-product-list");product_list.querySelectorAll(".total-sum").forEach(function(el){let result=parseFloat(el.dataset.total);total_sum+=result});let total_product_sum=document.getElementById("total_product_sum");let total_list=document.getElementById("total_all_sum");let total_summ_format=new Intl.NumberFormat($locale,{style:"currency",currency:"RUB",maximumFractionDigits:0}).format(total_sum);total_product_sum.innerText=total_summ_format;total_list.innerText=total_summ_format}function addOrderProductDeletedItem(btn,el){let prototypeContent=document.getElementById(btn.dataset.itemsDeletedPrototype).innerText;prototypeContent=prototypeContent.replace(/__deleted-item__/g,btn.dataset.itemsIndex);let deletedItems=document.getElementById(btn.dataset.itemsDeleted);const template=document.createElement("template");template.innerHTML=prototypeContent.trim();for(let input of template.content.children){if(input.id.endsWith("_id")){const itemId=el.querySelector("#"+el.id+"_id");if(itemId){input.value=itemId.dataset.itemsId.trim()}}if(input.id.endsWith("_product")){const itemProduct=el.querySelector("#"+el.id+"_product");if(itemProduct){input.value=itemProduct.dataset.itemsProduct.trim()}}if(input.id.endsWith("_const")){const itemConst=el.querySelector("#"+el.id+"_const");if(itemConst){input.value=itemConst.dataset.itemsConst.trim()}}}const fragment=template.content.cloneNode(true);deletedItems.appendChild(fragment)}