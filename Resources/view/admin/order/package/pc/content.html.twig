{% trans_default_domain 'orders-order.admin' %}


{% set disabled = {} %}


<div class="modal-dialog modal-dialog-centered" style="max-width: 800px;">
    {{ form_start(form) }}
    <div class="modal-content p-3 border-bottom border-5 border-primary">
        <div class="modal-header">

            <h5 class="modal-title">
                {# Заголовок модального окна #}
                {{ 'Отправить заказы на упаковку'|trans }}

            </h5>

            <div class="btn btn-icon btn-sm btn-active-light-primary ms-2" data-bs-dismiss="modal" title="Close">
                <span class="svg-icon svg-icon-2x"></span>
            </div>
        </div>

        <div class="modal-body" id="modal-body">

            {{ form_row(form.profile, {
                label: 'Склад для упаковки заказа', placeholder: 'Выберите ближайший Склад для упаковки заказа ...', attr: { 'data-select' : 'select2' }
            }) }}

            {% for orders in form.orders %}
                {{ form_widget(orders.id) }}
            {% endfor %}


            <div class="clearfix d-flex gap-3 align-items-center mb-3">
                <div class="text-nowrap text-muted">Продукция в заказе</div>
                <div class="w-100">
                    <hr class="clearfix">
                </div>
            </div>


            {% for product in form.products|filter(v => v.vars.data.card is not empty) %}

                <div class="d-flex gap-3 align-items-center w-100">

                    {# @var card \BaksDev\Orders\Order\Repository\ProductUserBasket\ProductUserBasketResult #}
                    {% set card = product.vars.data.card %}

                    {# Обложка  #}
                    <div>
                        <div class="icon rounded-4 mb-2 bg-contain p-1"
                             style="width: 75px; height: 75px; background-image: url('{{ cdn_image_path(card.productImage, card.productImageExt, card.productImageCdn, 'min') }}');"
                        ></div>
                    </div>

                    <div class="w-100 d-flex align-items-center gap-1">
                        <strong>
                            {{ card.productName }}

                            {# Значение множественного варианта ТП #}
                            {{ card.productVariationValue|call_twig_func(card.productVariationReference~'_render') ~
                            card.productModificationValue|call_twig_func(card.productModificationReference~'_render') }}

                            {# Значение торгового предложения #}
                            {{ card.productOfferValue|call_twig_func(card.productOfferReference~'_render') }}
                        </strong>

                        {# Количество в заказе #}
                        <strong class="text-primary">
                            ( {{ product.vars.data.total }} шт. )
                        </strong>


                        {% if card.stock > 0 %}
                            &nbsp; <span
                                class={{ card.stock < product.vars.data.total ? "text-danger" : "text-success" }}>В наличии  <strong>{{ card.stock }}</strong> шт. </span>
                        {% else %}
                            <span class="badge rounded-pill text-bg-danger ms-1">Нет в наличии</span>
                            {% set disabled = { disabled : true } %}
                        {% endif %}


                        {{ form_widget(product.product) }}
                        {{ form_widget(product.offer) }}
                        {{ form_widget(product.variation) }}
                        {{ form_widget(product.modification) }}
                        {{ form_widget(product.total) }}
                        {{ form_widget(product.stock) }}


                        {#                        {% endif %} #}

                    </div>

                    {% if product.move is defined %}
                        {{ form_widget(product.move, { attr: {
                            'data-bs-target': '#modal'
                        }, label: '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-left-right" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1 11.5a.5.5 0 0 0 .5.5h11.793l-3.147 3.146a.5.5 0 0 0 .708.708l4-4a.5.5 0 0 0 0-.708l-4-4a.5.5 0 0 0-.708.708L13.293 11H1.5a.5.5 0 0 0-.5.5m14-7a.5.5 0 0 1-.5.5H2.707l3.147 3.146a.5.5 0 1 1-.708.708l-4-4a.5.5 0 0 1 0-.708l4-4a.5.5 0 1 1 .708.708L2.707 4H14.5a.5.5 0 0 1 .5.5"></path></svg>' }) }}
                    {% endif %}
                </div>


            {% else %}

                <div class="alert alert-danger clearfix" role="alert">
                    В заказе отстутсвет продукция для упаковки
                </div>


            {% endfor %}

        </div>


        <div class="modal-footer">

            <div class="flex-grow-1">
                &nbsp;
            </div>

            <div class="d-flex gap-3">
                {# Отмена #}

                <button type="button" class="btn btn-light" data-bs-dismiss="modal">
                    {{ 'btn.cancel'|trans({}, 'core.btn') }}
                </button>

                {# Удалить #}
                {{ form_widget(form.package, { label: '
                    <span>'~ 'btn.save'|trans({}, 'core.btn') ~'</span>
                    <span class="spinner-border spinner-border-sm vertical-middle d-none"></span>
			    ', attr:  disabled }) }}
            </div>
        </div>
    </div>
    {{ form_end(form) }}
</div>

